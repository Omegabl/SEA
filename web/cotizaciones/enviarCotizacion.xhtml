<!DOCTYPE html>
<html lang="es" xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:pt="http://java.sun.com/jsf/passthrough" xmlns:p="http://primefaces.org/ui" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:pm="http://primefaces.org/mobile">
    <h:head>
        <meta charset="UTF-8" />
        <title>Enviar cotización | SEA</title>
        <link rel="shortcut icon" href="#{request.contextPath}/img/favicon.ico"/>
        <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1" />
        <h:outputStylesheet library="css" name="mdl-selectfield.min.css" />
        <h:outputStylesheet library="css" name="cotizaciones.css" />
        <h:outputScript library="js" name="mdl-selectfield.min.js"></h:outputScript>
        <h:outputScript library="js" name="toggleforms.js"></h:outputScript>
        <h:outputScript library="js" name="retroalimentacion.js"></h:outputScript>
    </h:head>
    <h:body>
        <ui:composition template="/templates/header.xhtml" />
        <f:view>
            <main>
                <h:form class="stepForm">
                    <section class="step">
                        <h3 class="mdl-typography--headline">Datos de la cotización</h3>
                        <h:panelGroup layout="block" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label ">
                            <h:inputText class="mdl-textfield__input" id="numeroCotizacion" value="#{loginController.mostrarIdInterno()}" pt:disabled="true" />
                            <h:outputLabel class="mdl-textfield__label" for="numeroCotizacion">Cotización No.</h:outputLabel>
                        </h:panelGroup>

                        <h:panelGroup layout="block" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label mdl-selectfield__select">
                            <p:selectOneMenu value="#{cotizacionController.cotizacion.lugarEmision}" filter="true" filterMatchMode="contains" style="width:100%;"
											 panelStyle="width:180px"  effect="fade">
                                <f:selectItems value="#{ciudadController.ciudades}" var="ciu" itemLabel="#{ciu.nombre}"
                                               itemValue="#{ciu.nombre}"/>
                            </p:selectOneMenu>
                            <h:outputLabel class="mdl-textfield__label" for="ciudadEmision">Ciudad de emisión</h:outputLabel>
                        </h:panelGroup>

                        <h:panelGroup layout="block" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                            <h:inputText pt:type="date" class="mdl-textfield__input" id="fechaEmision" value="#{cotizacionController.cotizacion.fechaEmision}" pt:disabled="true" />
                            <h:outputLabel class="mdl-textfield__label" for="fechaEmision">Fecha de emisión</h:outputLabel>
                        </h:panelGroup>

                        <h:panelGroup layout="block" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                            <h:outputLabel class="mdl-textfield__label" for="cliente">Empresa</h:outputLabel>
                            <p:selectOneMenu value="#{cotizacionController.idCliente}" filter="true" filterMatchMode="contains" style="width: 100%">
                                <p:ajax event="valueChange" listener="#{cotizacionController.obtenerDatosCliente()}" update="ciudad,departamento,e-mail1,e-mail2,telefono1,telefono2" />
                                <f:selectItems value="#{cotizacionController.clientes}" var="cli" itemLabel="#{cli.nombreORazonSocial}" itemValue="#{cli.idCliente}"/>
                            </p:selectOneMenu>
                        </h:panelGroup>

                        <h:panelGroup layout="block" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                            <h:inputText class="mdl-textfield__input" id="ciudad" value="#{cotizacionController.cliente[0]}" pt:disabled="true" />
                            <h:outputLabel class="mdl-textfield__label" for="ciudad">Ciudad</h:outputLabel>
                        </h:panelGroup>
                        <h:panelGroup layout="block" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                            <h:inputText class="mdl-textfield__input" id="departamento" value="#{cotizacionController.cliente[1]}" pt:disabled="true" />
                            <h:outputLabel class="mdl-textfield__label" for="departamento">Departamento</h:outputLabel>
                        </h:panelGroup>
                        <h:panelGroup layout="block" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                            <h:inputText class="mdl-textfield__input" p:type="email" id="e-mail1" value="#{cotizacionController.cliente[2]}" pt:disabled="true" />
                            <h:outputLabel class="mdl-textfield__label" for="e-mail1">e-mail 1</h:outputLabel>
                        </h:panelGroup>
                        <h:panelGroup layout="block" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                            <h:inputText class="mdl-textfield__input" p:type="email" id="e-mail2" value=""  pt:disabled="true" />
                            <h:outputLabel class="mdl-textfield__label" for="e-mail2">e-mail 2</h:outputLabel>
                        </h:panelGroup>
                        <h:panelGroup layout="block" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                            <h:inputText class="mdl-textfield__input" p:type="tel" id="telefono1" value="#{cotizacionController.cliente[3]}" pt:disabled="true" />
                            <h:outputLabel class="mdl-textfield__label" for="telefono1">Teléfono 1</h:outputLabel>
                        </h:panelGroup>
                        <h:panelGroup layout="block" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                            <h:inputText class="mdl-textfield__input" p:type="tel" id="telefono2" value="#{cotizacionController.cliente[5]}" pt:disabled="true" />
                            <h:outputLabel class="mdl-textfield__label" for="telefono2">Teléfono 2</h:outputLabel>
                        </h:panelGroup>
                        <h:panelGroup layout="block" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                            <h:inputText class="mdl-textfield__input" id="asesor" value="#{loginController.mostrarNombreUsuario()}" pt:disabled="true" />

                            <h:outputLabel class="mdl-textfield__label" for="asesor">Asesor</h:outputLabel>
                        </h:panelGroup>
                        <h:panelGroup layout="block" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                            <h:inputText class="mdl-textfield__input" id="numeroRemision" pt:maxlength="16" value="#{cotizacionController.cotizacion.numeroRemision}" />
                            <h:outputLabel class="mdl-textfield__label" for="numeroRemision">Número de remisión</h:outputLabel>
                        </h:panelGroup>
                        <h:panelGroup layout="block" />
                        <h:outputLabel class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="visita">
                            <h:selectBooleanCheckbox id="visita" class="mdl-switch__input" value="#{cotizacionController.cotizacion.visita}"/>
                            <h:panelGroup class="mdl-switch__label">Visita</h:panelGroup>
                        </h:outputLabel>
                        <h:outputLabel class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="prestamo">
                            <h:selectBooleanCheckbox id="prestamo" class="mdl-switch__input" value="#{cotizacionController.cotizacion.prestamoMuestra}" />
                            <h:panelGroup class="mdl-switch__label">Préstamo de muestras</h:panelGroup>
                        </h:outputLabel>
                        <h:panelGroup layout="block" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label fullWidth">
                            <h:inputTextarea id="relacionMuestra" class="mdl-textfield__input" pt:maxlength="512" pt:required="true" value="#{cotizacionController.cotizacion.relacionMuestra}" />
                            <h:outputLabel class="mdl-textfield__label" for="relacionMuestra">Relación de muestras</h:outputLabel>
                        </h:panelGroup>
                    </section>
                    <section class="step">
                        <h3 class="mdl-typography--headline">Artículos a cotizar</h3>
                        <!-- Usar <template> para los artículos a cotizar -->
                        <h:panelGroup layout="block" class="buttons fullWidth">
                            <a href="#addArticulo" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent toggleSubForm">Agregar artículo</a>
                            <a href="#addArticulo" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent toggleSubForm">Modificar artículo</a>
                            <a class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent">Eliminar</a>
                            <a class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent" href="/reportes/listaDePrecios.html" target="_blank">Ver lista de precios</a>
                        </h:panelGroup>
                        <p:outputPanel id="productos">
							<p:dataTable id="mitabla" value="#{productoController.producto}" var="producto" 
										 emptyMessage="No se encontraron registros" paginator="true"
										 rows="3" paginatorPosition="bottom">
								<p:column headerText="referencia" id="referencia" filterBy="#{producto.referencia}" filterMatchMode="contains">
									<h:outputText value="#{producto.referencia}"/>
								</p:column>
								<p:column headerText="descripcion" id="nombres" filterBy="#{producto.descripcion}" filterMatchMode="contains">
									<h:outputText value="#{producto.descripcion}"/>
								</p:column>

							</p:dataTable>
						</p:outputPanel>


                    </section>





                    <h:panelGrid columns="2" id="conComerciales" style="margin-bottom:10px" cellpadding="5">
                        <section class="step">
                            <h3 class="mdl-typography--headline">Condiciones comerciales</h3>
                            <h:panelGroup layout="block" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                                <h:inputText  class="mdl-textfield__input" p:type="number" id="descuento" pt:required="true" p:min="0" p:max="100" p:step="0.01" value="15" />
                                <h:outputLabel class="mdl-textfield__label" for="descuento">Descuento</h:outputLabel>
                            </h:panelGroup>
                            <h:panelGroup layout="block" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                                <output class="mdl-textfield__input" id="totalDescuento">649050</output>
                                <h:outputLabel class="mdl-textfield__label" for="totalDescuento">Total descuento</h:outputLabel>
                            </h:panelGroup>
                            <h:panelGroup layout="block" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                                <h:inputText  class="mdl-textfield__input" p:type="number" id="IVA" pt:required="true" p:min="0" p:max="100" p:step="0.01" value="16" />
                                <h:outputLabel class="mdl-textfield__label" for="IVA">IVA</h:outputLabel>
                            </h:panelGroup>
                            <h:panelGroup layout="block" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                                <output class="mdl-textfield__input" id="totalIVA">588472</output>
                                <h:outputLabel class="mdl-textfield__label" for="totalIVA">Total IVA</h:outputLabel>
                            </h:panelGroup>
                            <h:panelGroup layout="block" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                                <output class="mdl-textfield__input" id="subtotal">3677950</output>
                                <h:outputLabel class="mdl-textfield__label" for="subtotal">Subtotal: </h:outputLabel>
                            </h:panelGroup>
                            <h:panelGroup layout="block" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                                <output class="mdl-textfield__input" id="total">4266422</output>
                                <h:outputLabel class="mdl-textfield__label" for="total">Total: </h:outputLabel>
                            </h:panelGroup>





                            <h:panelGroup layout="block" class="mdl-selectfield mdl-js-selectfield mdl-selectfield--floating-label">
                                <h:outputLabel class="mdl-selectfield__label" for="formaPago">Forma de pago</h:outputLabel>
                                <p:outputLabel value="Forma Pago" />
                                <p:selectOneMenu style="width: 100%" panelStyle="width:180px"
												 effect="fade">
                                    <f:selectItems value="#{modalidadDePagoController.modalidad}" var="moda" itemLabel="#{moda.descripcion}"/>
                                </p:selectOneMenu>
                            </h:panelGroup>

                            <h:panelGroup layout="block" class="mdl-selectfield mdl-js-selectfield mdl-selectfield--floating-label">
                                <h:outputLabel class="mdl-selectfield__label" for="lugarEntrega">Lugar de entrega</h:outputLabel>
                                <p:outputLabel value="Lugar de entrega" />
                                <p:selectOneMenu style="width: 100%">
                                    <f:selectItems value="#{lugaresEntregaController.entregas}" var="lug" itemLabel="#{lug.descripcion}"/>
                                </p:selectOneMenu>
                            </h:panelGroup>

                            <h:panelGroup layout="block" class="mdl-selectfield mdl-js-selectfield mdl-selectfield--floating-label">
                                <h:outputLabel class="mdl-selectfield__label" for="descuentoVolumen">Descuento por volumen</h:outputLabel>
                                <p:selectOneMenu style="width: 100%">
                                    <f:selectItems value="#{descuentoVolumenController.descuentoVolumen}" var="desV" itemLabel="#{desV.descripcion}"/>
                                </p:selectOneMenu>

                            </h:panelGroup>
                            <h:panelGroup layout="block" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                                <h:inputText class="mdl-textfield__input" p:type="number" id="validezCotizacion" p:min="1" p:step="1" value="60" pt:required="true" />
                                <h:outputLabel class="mdl-textfield__label" for="validesCotizacion">Validez de la oferta: </h:outputLabel>
                            </h:panelGroup>

                            <h:panelGroup layout="block" class="mdl-selectfield mdl-js-selectfield mdl-selectfield--floating-label">
                                <h:outputLabel class="mdl-selectfield__label" for="tiempoEntrega">Tiempo de entrega: </h:outputLabel>
                                <p:selectOneMenu style="width: 100%">
                                    <f:selectItems value="#{tiempoEntregaController.tiempoEntregas}" var="tiemE" itemLabel="#{tiemE.descripcion}"/>
                                </p:selectOneMenu>
                            </h:panelGroup>

                            <h:panelGroup layout="block" class="mdl-selectfield mdl-js-selectfield mdl-selectfield--floating-label">
                                <h:outputLabel class="mdl-selectfield__label" for="ofertaNoIncluye">La oferta no incluye: </h:outputLabel>
                                <p:selectOneMenu style="width: 100%">
                                    <f:selectItems value="#{propuestaNoIncluyeController.propuestaNoIncluye}" var="proN" itemLabel="#{proN.descripcion}"/>
                                </p:selectOneMenu>
                            </h:panelGroup>

                        </section>
                    </h:panelGrid>


                    <section class="step">
                        <h3 class="mdl-typography--headline">Enviar la cotización</h3>
                        <h:outputLabel class="mdl-switch mdl-js-switch fullWidth" for="enviarCotizacion">
                            <h:selectBooleanCheckbox class="mdl-switch__input" id="enviarCotizacion"  />
                            <h:panelGroup class="mdl-switch__label">Enviar la cotización por correo electrónico</h:panelGroup>
                        </h:outputLabel>


                        <h:panelGroup layout="block" class="mdl-selectfield mdl-js-selectfield mdl-selectfield--floating-label fullWidth">
                            <select class="mdl-selectfield__select" id="formatoReporte" required="required">
                                <option value=""></option>
                                <option value="1">PDF</option>
                                <option value="2">Excel</option>
                            </select>
                            <h:outputLabel class="mdl-selectfield__label" for="lugarEntrega">Seleccione el formato de la cotización</h:outputLabel>
                        </h:panelGroup>
                        <h:panelGroup layout="block" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label fullWidth">
                            <h:inputTextarea class="mdl-textfield__input" id="cuerpoMensaje" pt:required="true" />
                            <h:outputLabel class="mdl-textfield__label" for="cuerpoMensaje">Cuerpo del mensaje a enviar</h:outputLabel>
                        </h:panelGroup>
                        <h:panelGroup layout="block" class="buttons fullWidth">
                            <h:commandButton class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent notificacion" value="Enviar y realizar seguimiento" actionListener="#{cotizacionController.registrarCotización()}" />
                            <h:commandButton class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent notificacion" value="Realizar seguimiento" />
                        </h:panelGroup>
                    </section>
                </h:form>
            </main>
            <aside id="subForm">
                <h:form id="addArticulo" class="mdl-dialog">
                    <h3 class="mdl-dialog__title">Agregar artículo</h3>
                    <h:panelGroup layout="block" class="mdl-dialog__content">
                        <h:panelGroup layout="block" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                            <h:outputLabel class="mdl-textfield__label" for="referencia">Referencia</h:outputLabel>
                            <h:outputLabel class="mdl-textfield__input" value="Referencia"/>
                            <p:selectOneMenu value="#{productoController.idProducto}" filter="true" filterMatchMode="contains" style="width: 100%">
                                <p:ajax event="valueChange" listener="#{productoController.obtenerDescripcionReferencia()}" update="descripcion, material, fabricante, precioUnitario" />
                                <f:selectItems value="#{productoController.producto}" var="ref" itemLabel="#{ref.referencia}" itemValue="#{ref.idProducto}"/>
                            </p:selectOneMenu>
                        </h:panelGroup>

                        <h:panelGroup layout="block" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                            <h:inputTextarea class="mdl-textfield__input" id="descripcion"  value="#{productoController.productoDescripcion.descripcion}" pt:disabled="true" ></h:inputTextarea>
                            <h:outputLabel class="mdl-textfield__label" for="descripcion">Descripción</h:outputLabel>
                        </h:panelGroup>

                    </h:panelGroup>
                    <h:panelGroup layout="block" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                        <h:inputText class="mdl-textfield__input" id="material" value="#{productoController.listaMateriales[0]}" pt:disabled="true" />
                        <h:outputLabel class="mdl-textfield__label" for="material">Material</h:outputLabel>
                    </h:panelGroup>
                    <h:panelGroup layout="block" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                        <h:inputText class="mdl-textfield__input" id="fabricante" value="#{productoController.listaFabricante[0]}" pt:disabled="true" />
                        <h:outputLabel class="mdl-textfield__label" for="fabricante">Fabricante</h:outputLabel>
                    </h:panelGroup>
                    <h:panelGroup layout="block" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                        <h:inputText class="mdl-textfield__input" p:type="number" p:min="1" p:step="1" pt:maxlength="32" pt:required="true" value="#{cotizacionProductoController.cotizacionP.cantidad}" />
                        <h:outputLabel class="mdl-textfield__label" for="cantidadMinima">Cantidad mínima</h:outputLabel>
                    </h:panelGroup>
                    <h:panelGroup layout="block" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                        <h:inputText class="mdl-textfield__input" p:type="number" id="precioUnitario" value="#{productoController.listaProductoPrecio[0]}" pt:disabled="true" />
                        <h:outputLabel class="mdl-textfield__label" for="precioUnitario">Precio Unitario (Sin Descuento)</h:outputLabel>
                    </h:panelGroup>
                    <h:panelGroup layout="block" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                        <h:inputText class="mdl-textfield__input" p:type="number" value="#{cotizacionProductoController.cotizacionP.precioParaCliente}" />
                        <h:outputLabel class="mdl-textfield__label" for="precioModificado">Precio para el cliente</h:outputLabel>
                    </h:panelGroup>
                    <h:panelGroup layout="block" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                        <output class="mdl-textfield__input" id="precioUnitarioDescuento">7650</output>
                        <h:outputLabel class="mdl-textfield__label" for="precioUnitarioDescuento">Precio Unitario (Con Descuento)</h:outputLabel>
                    </h:panelGroup>
                    <h:panelGroup layout="block" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                        <output class="mdl-textfield__input" id="precioTotalDescuento">84150</output>
                        <h:outputLabel class="mdl-textfield__label" for="precioTotalDescuento">Precio Total</h:outputLabel>
                    </h:panelGroup>
                    <h:panelGroup layout="block" class="mdl-dialog__actions">
                        <button id="mostrarArticuloAgregado" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent toggleSubForm" type="submit">Agregar artículo</button>
						<h:commandButton action="#{productoController.setProducto(productoController.producto)}" value="Añadir"></h:commandButton>

						<p:commandButton type="reset"  value="cancelar" />


                    </h:panelGroup>
                </h:form>

            </aside>







            <ui:composition template="/templates/navGeneral.xhtml" />
            <ui:composition template="/templates/taskTabs.xhtml" />
            <aside>
                <h:panelGroup layout="block" id="articuloAgregado" class="mdl-js-snackbar mdl-snackbar">
                    <h:panelGroup layout="block" class="mdl-snackbar__text"></h:panelGroup>
                    <button class="mdl-snackbar__action" type="button"></button>
                </h:panelGroup>
                <script>
					(function () {
						'use strict';
						window['counter'] = 0;
						var snackbarContainer = document.querySelector('#articuloAgregado');
						var showToastButton = document.querySelector('#mostrarArticuloAgregado');
						var handler = function (event) {
							console.log("artículo removido");
						};
						showToastButton.addEventListener('click', function () {
							'use strict';
							var data = {message: 'Artículo añadido a la cotización.', timeout: 5000, actionHandler: handler, actionText: 'Deshacer'};
							snackbarContainer.MaterialSnackbar.showSnackbar(data);
						});
					}());
                </script>
            </aside>

        </f:view>
    </h:body>
</html>
